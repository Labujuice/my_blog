<!DOCTYPE html><html lang="zh-tw"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Docker 2 撰寫 Dockerfile - Kenny&#x27;s Blog</title><meta name="description" content="這是幹麻的？Docker 在我的應用是要拿來用在CI Server 上 Build code 以及做一些簡單的 unit-test，而現實的狀況是 空白的 ubuntu img 內是沒有安裝任何的 gcc, g++, gcc-arm-none-eabi, gtest 等，因此我會希望每次CI開始跑開 contiainer 就可以有這樣的環境縮短每次開始做編譯的環境架設之時間。 同理，如果單純只是想要架設一個環境來玩，玩壞了又可以再生，也是可以透過這樣的手法建立docker img，只是這一篇是以建立編譯環境作為範例而已。 先介紹幾個最基本的要素，要製作一個image檔案需要做的事情 FROM 告知你要使用那一個image來製作 LABEL 標籤，可以留下你的姓名跟電話還有想說的廢話， 例如: LABEL maintainer=&quot;kenny chan &lt;kennycym@gmail.com&gt;&quot;LABEL Description=&quot;Image for building gcc, g++, arm-gcc project.&quot;WORKDIR 執行RUN, CMD, ENTRYPOINT, COPY and ADD 的目錄&hellip;"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://labujuice.github.io/my_blog/docker-2-zhuan-xie-dockerfile.html"><link rel="alternate" type="application/atom+xml" href="https://labujuice.github.io/my_blog/feed.xml"><link rel="alternate" type="application/json" href="https://labujuice.github.io/my_blog/feed.json"><style>:root{--body-font:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";--heading-font:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";--logo-font:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";--menu-font:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol"}</style><link rel="stylesheet" href="https://labujuice.github.io/my_blog/assets/css/style.css?v=a7ae6fe986eb05c4dff6f18a90646277"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://labujuice.github.io/my_blog/docker-2-zhuan-xie-dockerfile.html"},"headline":"Docker 2 撰寫 Dockerfile","datePublished":"2021-03-03T09:58","dateModified":"2021-03-04T15:16","description":"這是幹麻的？Docker 在我的應用是要拿來用在CI Server 上 Build code 以及做一些簡單的 unit-test，而現實的狀況是 空白的 ubuntu img 內是沒有安裝任何的 gcc, g++, gcc-arm-none-eabi, gtest 等，因此我會希望每次CI開始跑開 contiainer 就可以有這樣的環境縮短每次開始做編譯的環境架設之時間。 同理，如果單純只是想要架設一個環境來玩，玩壞了又可以再生，也是可以透過這樣的手法建立docker img，只是這一篇是以建立編譯環境作為範例而已。 先介紹幾個最基本的要素，要製作一個image檔案需要做的事情 FROM 告知你要使用那一個image來製作 LABEL 標籤，可以留下你的姓名跟電話還有想說的廢話， 例如: LABEL maintainer=&quot;kenny chan &lt;kennycym@gmail.com&gt;&quot;LABEL Description=&quot;Image for building gcc, g++, arm-gcc project.&quot;WORKDIR 執行RUN, CMD, ENTRYPOINT, COPY and ADD 的目錄&hellip;","author":{"@type":"Person","name":"Kenny Chan"},"publisher":{"@type":"Organization","name":"Kenny Chan"}}</script></head><body><div class="site-container"><header class="top" id="js-header"><a class="logo" href="https://labujuice.github.io/my_blog/">Kenny&#x27;s Blog</a><nav class="navbar js-navbar"><button class="navbar__toggle js-toggle" aria-label="Menu" aria-haspopup="true" aria-expanded="false"><span class="navbar__toggle-box"><span class="navbar__toggle-inner">Menu</span></span></button><ul class="navbar__menu"><li><a href="https://labujuice.github.io/my_blog/about-me.html" target="_self">ABOUT</a></li><li><a href="https://labujuice.github.io/my_blog/tags/" target="_self">Tags</a></li><li><a href="https://labujuice.github.io/my_blog/tags/stm32/" target="_self">STM32</a></li><li class="active-parent has-submenu"><a href="https://labujuice.github.io/my_blog/tags/docker/" target="_self" aria-haspopup="true">Docker</a><ul class="navbar__submenu level-2" aria-hidden="true"><li><a href="https://labujuice.github.io/my_blog/docker-1-installatio.html" target="_self">Docker 1: 安裝</a></li><li class="active"><a href="https://labujuice.github.io/my_blog/docker-2-zhuan-xie-dockerfile.html" target="_self">Docker 2: Dockerfile</a></li><li><a href="https://labujuice.github.io/my_blog/docker-3-shi-yongcontainer.html" target="_self">Docker 3: Compile with container</a></li></ul></li><li class="has-submenu"><a href="https://labujuice.github.io/my_blog/tags/git/" target="_self" aria-haspopup="true">Git</a><ul class="navbar__submenu level-2" aria-hidden="true"><li class="has-submenu"><span class="is-separator" aria-haspopup="true">Gitlab-Runner</span><ul class="navbar__submenu level-3" aria-hidden="true"><li><a href="https://labujuice.github.io/my_blog/gitlab-runner-2.html" target="_self">Gitlab-Runner 安裝</a></li><li><a href="https://labujuice.github.io/my_blog/submodule-with-gitlab-cicd.html" target="_self">Submodule with CI/CD</a></li></ul></li></ul></li><li><a href="https://labujuice.github.io/my_blog/submodule-with-gitlab-cicd.html" target="_self">Submodule with CI/CD</a></li></ul></nav></header><main><article class="post"><div class="hero"><figure class="hero__image hero__image--overlay"><img src="https://labujuice.github.io/my_blog/media/website/IMG_1387-1.JPG" srcset="https://labujuice.github.io/my_blog/media/website/responsive/IMG_1387-1-xs.JPG 300w, https://labujuice.github.io/my_blog/media/website/responsive/IMG_1387-1-sm.JPG 480w, https://labujuice.github.io/my_blog/media/website/responsive/IMG_1387-1-md.JPG 768w, https://labujuice.github.io/my_blog/media/website/responsive/IMG_1387-1-lg.JPG 1024w, https://labujuice.github.io/my_blog/media/website/responsive/IMG_1387-1-xl.JPG 1360w, https://labujuice.github.io/my_blog/media/website/responsive/IMG_1387-1-2xl.JPG 1600w" sizes="(max-width: 1600px) 100vw, 1600px" loading="eager" alt=""></figure><header class="hero__content"><div class="wrapper"><div class="post__meta"><time datetime="2021-03-03T09:58">三月 3, 2021</time></div><h1>Docker 2 撰寫 Dockerfile</h1><div class="post__meta post__meta--author"><img src="https://labujuice.github.io/my_blog/media/website/IMG_6244.JPG" loading="eager" alt="Kenny Chan" class="post__author-thumb"> <a href="https://labujuice.github.io/my_blog/authors/kenny-chan/" class="feed__author invert">Kenny Chan</a></div></div></header></div><div class="wrapper post__entry"><h2 id="這是幹麻的？">這是幹麻的？</h2><p>Docker 在我的應用是要拿來用在CI Server 上 Build code 以及做一些簡單的 unit-test，而現實的狀況是 空白的 ubuntu img 內是沒有安裝任何的 gcc, g++, gcc-arm-none-eabi, gtest 等，因此我會希望每次CI開始跑開 contiainer 就可以有這樣的環境縮短每次開始做編譯的環境架設之時間。</p><p>同理，如果單純只是想要架設一個環境來玩，玩壞了又可以再生，也是可以透過這樣的手法建立docker img，只是這一篇是以建立編譯環境作為範例而已。</p><h2 id="dockerfile-常用基本指令">Dockerfile 常用基本指令</h2><p>先介紹幾個最基本的要素，要製作一個image檔案需要做的事情</p><p><code>FROM</code> 告知你要使用那一個image來製作</p><p><code>LABEL</code> 標籤，可以留下你的姓名跟電話還有想說的廢話， 例如:</p><pre><code>LABEL maintainer=&quot;kenny chan &lt;kennycym@gmail.com&gt;&quot;
LABEL Description=&quot;Image for building gcc, g++, arm-gcc project.&quot;</code></pre><p><code>WORKDIR</code> 執行RUN, CMD, ENTRYPOINT, COPY and ADD 的目錄</p><p><code>ADD</code> 將檔案或者資料夾加入 contaner</p><p><code>RUN</code> 執行指令，像是平常在terminal內打的指令一樣。</p><p><code>ENV</code> 進行一些環境相關的設定，或者變數的宣告等。</p><h2 id="一個範例">一個範例</h2><p>以我最常用的 gcc, g++, gcc-arm-none-eabi, git 製作一個dockerfile，在這個檔案開始進行之前，要先去下載我指定的gcc-arm-none-eabi 2018q2版本，並且將他放在同樣的目錄之下。</p><p>不知道上那下載可以<a href="https://developer.arm.com/tools-and-software/open-source-software/developer-tools/gnu-toolchain/gnu-rm/downloads">點我下載</a>，如果想更換為喜歡的版本也行，就是要在修改一下檔名跟路徑。</p><pre><code>FROM ubuntu:20.04
LABEL maintainer=&quot;kenny chan &lt;kennycym@gmail.com&gt;&quot;
LABEL Description=&quot;Image for building gcc, g++, arm-gcc project.&quot;
WORKDIR /work

ADD . /work

# Install any needed packages specified in requirements.txt
RUN apt-get update &amp;&amp; \
    apt-get upgrade -y &amp;&amp; \
    apt-get install -y \
# Development files
      rsync \
      gcc \
      build-essential \
      git \
      bzip2 \
      wget &amp;&amp; \
    apt-get clean
RUN tar jxvf gcc-arm-none-eabi-7-2018-q2-update-linux.tar.bz2

ENV PATH &quot;/work/gcc-arm-none-eabi-7-2018-q2-update/bin:$PATH&quot;
</code></pre><p>鵝～其實這個範例是修改自<a href="https://hub.docker.com/r/stronglytyped/arm-none-eabi-gcc/dockerfile">這裡</a>的。</p><h2 id="build-docker-img">Build Docker Img</h2><p>完成後我們可以先看一下目前目錄下有哪些東西</p><pre><code>$ ls
dockerfile  gcc-arm-none-eabi-7-2018-q2-update-linux.tar.bz2</code></pre><p>確認有這兩樣東西後，接著執行</p><pre><code>docker build -t ubuntu_gcc_arm_gcc . --no-cache</code></pre><p>這邊有些可說明的，加入<code>-t</code> 可以指定輸出的image ，如果要輸出至兩個或以上就直接 <code>-t image1 -t image2 ,...</code> ， 如果要指定dockerfile 則是<code>-f path/dockerfilename</code> 這樣的手法達成，但不指定就是預設當前目錄下的dockerfile。</p><p>後面加上 <code>--no-cache</code> 則會讓每次build都不會cache住先前的資料，雖然比較慢，但是中間失誤的機會會比較少一些。 (當然熟練的話就不需要這樣子了)</p><p>完成後可以使用<code>docker images</code> 來看看是否已經存在，他的長相應該會是這樣子：</p><pre><code>REPOSITORY                            TAG       IMAGE ID       CREATED        SIZE
ubuntu_gcc_arm_gcc                    latest    1b40dcef2857   20 hours ago   921MB
ubuntu                                20.04     f63181f19b2f   6 weeks ago    72.9MB
ubuntu                                latest    f63181f19b2f   6 weeks ago    72.9MB</code></pre><p>可以發現 <code>ubuntu_gcc_arm_gcc</code> 是存在的。</p><h2 id="確認系統環境">確認系統環境</h2><p>完成後我們可以執行該image</p><pre><code>docker run -it ubuntu_gcc_arm_gcc</code></pre><p>執行後應該可以進去該container的控制界面，那我們就來敲敲看各個編譯器的版本號吧！ <code>gcc -v</code> <code>g++ -v</code> <code>arm-none-eabi-gcc -v</code></p><p>應該要得到的結果是：</p><p><strong>gcc</strong></p><p><code>gcc version 9.3.0 (Ubuntu 9.3.0-17ubuntu1~20.04)</code></p><p><strong>g++</strong></p><p><code>gcc version 7.3.1 20180622 (release) [ARM/embedded-7-branch revision 261907] (GNU Tools for Arm Embedded Processors 7-2018-q2-update)</code></p><p><strong>arm-none-eabi-gcc</strong></p><p><code>gcc version 7.3.1 20180622 (release) [ARM/embedded-7-branch revision 261907] (GNU Tools for Arm Embedded Processors 7-2018-q2-update)</code></p><h2 id="references">References</h2><ol><li><a href="https://docs.docker.com/engine/reference/builder/">Docker Docs: Dockerfile reference</a></li><li><a href="https://hub.docker.com/r/stronglytyped/arm-none-eabi-gcc/dockerfile">Docker Hub : stronglytyped/arm-none-eabi-gcc</a></li><li><a href="https://ithelp.ithome.com.tw/users/20103456/ironman/1320">用30天來介紹和使用 Docker 系列</a></li></ol></div><footer class="wrapper post__footer"><p class="post__last-updated">This article was updated on 三月 4, 2021</p><ul class="post__tag"><li><a href="https://labujuice.github.io/my_blog/tags/docker/">Docker</a></li></ul><div class="post__share"></div><div class="post__bio bio"><img class="bio__avatar" src="https://labujuice.github.io/my_blog/media/website/IMG_6244.JPG" loading="lazy" alt="Kenny Chan"><div class="bio__info"><h3 class="bio__name"><a href="https://labujuice.github.io/my_blog/authors/kenny-chan/" class="invert" rel="author">Kenny Chan</a></h3><p>一個常常忘記自己做過什麼的人，所以才要把它們都記下來。</p></div></div></footer></article><nav class="post__nav"><div class="post__nav-inner"><div class="post__nav-prev"><svg width="1.041em" height="0.416em" aria-hidden="true"><use xlink:href="https://labujuice.github.io/my_blog/assets/svg/svg-map.svg#arrow-prev"/></svg> <a href="https://labujuice.github.io/my_blog/docker-1-installatio.html" class="invert post__nav-link" rel="prev"><span>Previous</span> Docker 1 安裝</a></div><div class="post__nav-next"><a href="https://labujuice.github.io/my_blog/docker-3-shi-yongcontainer.html" class="invert post__nav-link" rel="next"><span>Next</span> Docker 3 use container to compile </a><svg width="1.041em" height="0.416em" aria-hidden="true"><use xlink:href="https://labujuice.github.io/my_blog/assets/svg/svg-map.svg#arrow-next"/></svg></div></div></nav><div class="post__related related"><div class="wrapper"><h2 class="h5 related__title">You should also read:</h2><article class="related__item"><div class="feed__meta"><time datetime="2021-03-04T16:51" class="feed__date">三月 4, 2021</time></div><h3 class="h1"><a href="https://labujuice.github.io/my_blog/docker-3-shi-yongcontainer.html" class="invert">Docker 3 use container to compile</a></h3></article><article class="related__item"><div class="feed__meta"><time datetime="2021-03-03T09:47" class="feed__date">三月 3, 2021</time></div><h3 class="h1"><a href="https://labujuice.github.io/my_blog/docker-1-installatio.html" class="invert">Docker 1 安裝</a></h3></article></div></div></main><footer class="footer"><div class="footer__copyright"><p>Powered by <a href="https://getpublii.com" target="_blank" rel="nofollow noopener">Publii</a></p></div><button class="footer__bttop js-footer__bttop" aria-label="Back to top"><svg><title>Back to top</title><use xlink:href="https://labujuice.github.io/my_blog/assets/svg/svg-map.svg#toparrow"/></svg></button></footer></div><script>window.publiiThemeMenuConfig = {    
        mobileMenuMode: 'sidebar',
        animationSpeed: 300,
        submenuWidth: 300,
        doubleClickTime: 500,
        mobileMenuExpandableSubmenus: true, 
        relatedContainerForOverlayMenuSelector: '.top',
   };</script><script defer="defer" src="https://labujuice.github.io/my_blog/assets/js/scripts.min.js?v=f4c4d35432d0e17d212f2fae4e0f8247"></script><script>var images = document.querySelectorAll('img[loading]');

        for (var i = 0; i < images.length; i++) {
            if (images[i].complete) {
                images[i].classList.add('is-loaded');
            } else {
                images[i].addEventListener('load', function () {
                    this.classList.add('is-loaded');
                }, false);
            }
        }</script></body></html>